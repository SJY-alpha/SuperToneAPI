<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>테트리스 게임</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #0f172a, #020617 60%);
            color: #e2e8f0;
            min-height: 100vh;
        }
        canvas {
            background: rgba(15, 23, 42, 0.85);
            border-radius: 0.5rem;
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 10px 40px rgba(15, 23, 42, 0.55);
        }
        .glass-panel {
            background: rgba(15, 23, 42, 0.65);
            border: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(2, 6, 23, 0.6);
            backdrop-filter: blur(10px);
        }
        .stat-label {
            color: #94a3b8;
            font-size: 0.75rem;
            letter-spacing: 0.08em;
        }
        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: #38bdf8;
            text-shadow: 0 0 12px rgba(56, 189, 248, 0.45);
        }
        .neon-button {
            background: linear-gradient(135deg, #0ea5e9, #6366f1);
            border-radius: 9999px;
            padding: 0.75rem 1.75rem;
            font-weight: 600;
            color: #f8fafc;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .neon-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 30px rgba(14, 165, 233, 0.45);
        }
        .control-key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            padding: 0.35rem 0.9rem;
            font-size: 0.875rem;
            color: #e2e8f0;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: inset 0 1px 0 rgba(148, 163, 184, 0.25);
        }
    </style>
</head>
<body class="py-10">
    <div class="max-w-5xl mx-auto px-4">
        <header class="text-center mb-10">
            <p class="text-sky-300 uppercase tracking-[0.5em] text-xs mb-2">Retro Arcade</p>
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-50 mb-4">네온 테트리스</h1>
            <p class="text-slate-400 max-w-2xl mx-auto">방향키로 블록을 움직이고, 스페이스바로 빠르게 떨어뜨려 보세요. 한 줄을 가득 채우면 점수를 획득합니다. 레벨이 올라갈수록 속도가 빨라집니다!</p>
        </header>
        <main class="grid md:grid-cols-[minmax(0,_320px)_minmax(0,_1fr)] gap-8 items-start">
            <section class="glass-panel p-6 md:p-8 text-center">
                <canvas id="tetris" width="240" height="480" class="mx-auto"></canvas>
                <div class="mt-8 grid grid-cols-3 gap-4">
                    <div>
                        <p class="stat-label">SCORE</p>
                        <p id="score" class="stat-value">0</p>
                    </div>
                    <div>
                        <p class="stat-label">LINES</p>
                        <p id="lines" class="stat-value">0</p>
                    </div>
                    <div>
                        <p class="stat-label">LEVEL</p>
                        <p id="level" class="stat-value">1</p>
                    </div>
                </div>
                <div class="mt-6 flex justify-center gap-4">
                    <button id="toggle-btn" class="neon-button">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-9 3a1 1 0 102 0V7a1 1 0 10-2 0v6z" />
                            <path d="M9 15a1 1 0 102 0v-2a1 1 0 10-2 0v2z" />
                        </svg>
                        <span class="label">시작 / 일시정지</span>
                    </button>
                    <button id="reset-btn" class="neon-button">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 5a5 5 0 104.546 2.914.75.75 0 011.336-.686A6.5 6.5 0 1110 3.5V2a.75.75 0 011.5 0v3.75a.75.75 0 01-.75.75H7a.75.75 0 010-1.5h2.688A5.001 5.001 0 0010 5z" clip-rule="evenodd" />
                        </svg>
                        <span class="label">새 게임</span>
                    </button>
                </div>
            </section>
            <aside class="glass-panel p-6 md:p-8 space-y-6">
                <div>
                    <h2 class="text-xl font-semibold text-slate-100 mb-2">게임 방법</h2>
                    <p class="text-slate-400">떨어지는 블록을 회전시키고 이동시켜 빈칸 없이 줄을 채우면 줄이 사라지고 점수가 올라갑니다. 연속으로 줄을 없앨수록 더 많은 점수를 받을 수 있습니다.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-slate-200 mb-3">조작키</h3>
                    <div class="grid grid-cols-2 gap-3 text-left text-sm text-slate-300">
                        <div><span class="control-key">← →</span> 좌우 이동</div>
                        <div><span class="control-key">↑</span> 회전</div>
                        <div><span class="control-key">↓</span> 빠르게 내리기</div>
                        <div><span class="control-key">Space</span> 하드 드롭</div>
                        <div><span class="control-key">P</span> 일시정지</div>
                        <div><span class="control-key">R</span> 새 게임</div>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-slate-200 mb-3">Tip</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-400 text-sm">
                        <li>한 번에 여러 줄을 없애면 추가 점수를 얻습니다.</li>
                        <li>다음 블록을 미리 생각하며 빈 칸을 최소화해보세요.</li>
                        <li>위기 상황에서는 스페이스바로 빠르게 정리하세요!</li>
                    </ul>
                </div>
                <div class="pt-4 border-t border-slate-700/50 text-sm text-slate-500">
                    <p>Supertone API 데모 페이지로 돌아가려면 <a href="./index.html" class="text-sky-400 hover:text-sky-300">여기를 클릭</a>하세요.</p>
                </div>
            </aside>
        </main>
    </div>

    <script>
        const canvas = document.getElementById('tetris');
        const context = canvas.getContext('2d');
        context.scale(20, 20);

        const scoreElement = document.getElementById('score');
        const linesElement = document.getElementById('lines');
        const levelElement = document.getElementById('level');
        const toggleBtn = document.getElementById('toggle-btn');
        const resetBtn = document.getElementById('reset-btn');
        const toggleLabel = toggleBtn.querySelector('.label');

        const colors = [
            null,
            '#38bdf8', // I
            '#f97316', // L
            '#facc15', // O
            '#ef4444', // Z
            '#8b5cf6', // T
            '#22c55e', // S
            '#ec4899', // J
        ];

        const arena = createMatrix(12, 20);

        const player = {
            pos: { x: 0, y: 0 },
            matrix: null,
            score: 0,
            lines: 0,
            level: 1,
        };

        let dropCounter = 0;
        let dropInterval = 1000;
        let lastTime = 0;
        let paused = true;

        function arenaSweep() {
            let rowCount = 1;
            let linesCleared = 0;
            outer: for (let y = arena.length - 1; y > 0; --y) {
                for (let x = 0; x < arena[y].length; ++x) {
                    if (arena[y][x] === 0) {
                        continue outer;
                    }
                }

                const row = arena.splice(y, 1)[0].fill(0);
                arena.unshift(row);
                ++y;
                player.score += rowCount * 100;
                linesCleared += 1;
                rowCount *= 2;
            }

            if (linesCleared > 0) {
                player.lines += linesCleared;
                const newLevel = Math.floor(player.lines / 10) + 1;
                if (newLevel !== player.level) {
                    player.level = newLevel;
                    dropInterval = Math.max(100, 1000 - (player.level - 1) * 75);
                }
                updateScore();
            }
        }

        function collide(arena, player) {
            const [m, o] = [player.matrix, player.pos];
            for (let y = 0; y < m.length; ++y) {
                for (let x = 0; x < m[y].length; ++x) {
                    if (m[y][x] !== 0 && (arena[y + o.y] && arena[y + o.y][x + o.x]) !== 0) {
                        return true;
                    }
                }
            }
            return false;
        }

        function createMatrix(w, h) {
            const matrix = [];
            while (h--) {
                matrix.push(new Array(w).fill(0));
            }
            return matrix;
        }

        function createPiece(type) {
            switch (type) {
                case 'T':
                    return [
                        [0, 0, 0],
                        [5, 5, 5],
                        [0, 5, 0],
                    ];
                case 'O':
                    return [
                        [3, 3],
                        [3, 3],
                    ];
                case 'L':
                    return [
                        [0, 2, 0],
                        [0, 2, 0],
                        [0, 2, 2],
                    ];
                case 'J':
                    return [
                        [0, 7, 0],
                        [0, 7, 0],
                        [7, 7, 0],
                    ];
                case 'I':
                    return [
                        [0, 1, 0, 0],
                        [0, 1, 0, 0],
                        [0, 1, 0, 0],
                        [0, 1, 0, 0],
                    ];
                case 'S':
                    return [
                        [0, 6, 6],
                        [6, 6, 0],
                        [0, 0, 0],
                    ];
                case 'Z':
                    return [
                        [4, 4, 0],
                        [0, 4, 4],
                        [0, 0, 0],
                    ];
            }
        }

        function draw() {
            context.fillStyle = 'rgba(15, 23, 42, 0.9)';
            context.fillRect(0, 0, canvas.width, canvas.height);

            drawMatrix(arena, { x: 0, y: 0 });
            drawMatrix(player.matrix, player.pos);
        }

        function drawMatrix(matrix, offset) {
            matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        context.fillStyle = colors[value];
                        context.fillRect(x + offset.x, y + offset.y, 1, 1);
                        context.strokeStyle = 'rgba(226, 232, 240, 0.15)';
                        context.lineWidth = 0.05;
                        context.strokeRect(x + offset.x, y + offset.y, 1, 1);
                    }
                });
            });
        }

        function merge(arena, player) {
            player.matrix.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value !== 0) {
                        arena[y + player.pos.y][x + player.pos.x] = value;
                    }
                });
            });
        }

        function playerDrop() {
            player.pos.y++;
            if (collide(arena, player)) {
                player.pos.y--;
                merge(arena, player);
                playerReset();
                arenaSweep();
                updateScore();
            }
            dropCounter = 0;
        }

        function playerMove(dir) {
            player.pos.x += dir;
            if (collide(arena, player)) {
                player.pos.x -= dir;
            }
        }

        function playerReset() {
            const pieces = 'TJLOSZI';
            const type = pieces[Math.floor(Math.random() * pieces.length)];
            player.matrix = createPiece(type);
            player.pos.y = 0;
            player.pos.x = Math.floor(arena[0].length / 2) - Math.floor(player.matrix[0].length / 2);

            if (collide(arena, player)) {
                arena.forEach(row => row.fill(0));
                player.score = 0;
                player.lines = 0;
                player.level = 1;
                dropInterval = 1000;
                updateScore();
                paused = true;
                toggleLabel.textContent = '다시 시작하려면 클릭';
            }
        }

        function playerRotate(dir) {
            const pos = player.pos.x;
            let offset = 1;
            rotate(player.matrix, dir);
            while (collide(arena, player)) {
                player.pos.x += offset;
                offset = -(offset + (offset > 0 ? 1 : -1));
                if (offset > player.matrix[0].length) {
                    rotate(player.matrix, -dir);
                    player.pos.x = pos;
                    return;
                }
            }
        }

        function rotate(matrix, dir) {
            for (let y = 0; y < matrix.length; ++y) {
                for (let x = 0; x < y; ++x) {
                    [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
                }
            }

            if (dir > 0) {
                matrix.forEach(row => row.reverse());
            } else {
                matrix.reverse();
            }
        }

        function updateScore() {
            scoreElement.textContent = player.score.toLocaleString();
            linesElement.textContent = player.lines.toLocaleString();
            levelElement.textContent = player.level.toLocaleString();
        }

        function update(time = 0) {
            if (paused) {
                lastTime = time;
                draw();
                return;
            }
            const deltaTime = time - lastTime;
            lastTime = time;

            dropCounter += deltaTime;
            if (dropCounter > dropInterval) {
                playerDrop();
            }

            draw();
            requestAnimationFrame(update);
        }

        function togglePause() {
            paused = !paused;
            if (!paused) {
                toggleLabel.textContent = '일시정지';
                requestAnimationFrame(update);
            } else {
                toggleLabel.textContent = '다시 시작';
            }
        }

        function resetGame() {
            arena.forEach(row => row.fill(0));
            player.score = 0;
            player.lines = 0;
            player.level = 1;
            dropInterval = 1000;
            playerReset();
            updateScore();
            paused = true;
            toggleLabel.textContent = '시작 / 일시정지';
            draw();
        }

        document.addEventListener('keydown', event => {
            if (event.code === 'ArrowLeft') {
                playerMove(-1);
            } else if (event.code === 'ArrowRight') {
                playerMove(1);
            } else if (event.code === 'ArrowDown') {
                playerDrop();
            } else if (event.code === 'ArrowUp') {
                playerRotate(1);
            } else if (event.code === 'Space') {
                event.preventDefault();
                while (!collide(arena, player)) {
                    player.pos.y++;
                }
                player.pos.y--;
                merge(arena, player);
                playerReset();
                arenaSweep();
                updateScore();
                dropCounter = 0;
            } else if (event.code === 'KeyP') {
                togglePause();
            } else if (event.code === 'KeyR') {
                resetGame();
            }
        });

        toggleBtn.addEventListener('click', () => {
            if (player.matrix === null) {
                playerReset();
            }
            togglePause();
        });

        resetBtn.addEventListener('click', () => {
            resetGame();
        });

        // 초기화
        resetGame();
        update();
    </script>
</body>
</html>
